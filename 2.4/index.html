<script>
   const HEIGHT_2_4 = 791551;
   async function main() {
      const current = await (await fetch("https://api.blockcypher.com/v1/btc/main")).json();
      const current_height = current.height;
      const current_date = new Date(current.time);

      if (current_height >= HEIGHT_2_4) {
        document.getElementById("main").innerHTML = `Stacks 2.4 epoch height reached!`;
      } else {
        let approximation_height = current_height - (HEIGHT_2_4 - current_height);
        const prior = await (await fetch(`https://api.blockcypher.com/v1/btc/main/blocks/${approximation_height}?txstart=1&limit=1`)).json();
        const prior_date = new Date(prior.time);

        let second_approximation_height = current_height - 4 * (HEIGHT_2_4 - current_height);
        const second_prior = await (await fetch(`https://api.blockcypher.com/v1/btc/main/blocks/${second_approximation_height}?txstart=1&limit=1`)).json();
        const second_prior_date = new Date(second_prior.time);

        const seconds_delta = current_date - prior_date;
        const second_seconds_delta = (current_date - second_prior_date)/4;
        const expected_seconds_delta = (seconds_delta + second_seconds_delta) / 2;

        const expected_date = new Date(current_date.getTime() + expected_seconds_delta);

        document.getElementById("block_target").innerHTML = `<b>${HEIGHT_2_4}</b>`;
        document.getElementById("current_block").innerHTML = `<b>${current_height}</b>`;
        document.getElementById("expected_date").innerHTML = `<b>${expected_date}</b>`;
        document.getElementById("blocks_to_go").innerHTML = `<b>${HEIGHT_2_4 - current_height}</b>`;
        document.getElementById("used_block").innerHTML = `<b>${approximation_height}</b>`;
        document.getElementById("used_block_time").innerHTML = `<b>${prior_date}</b>`;
        document.getElementById("time_ago").innerHTML = `<b>${Math.floor(seconds_delta / 3600.0 / 10)/ 100.0}</b>`;
      }
   }
   main();
</script>
<h1>When 2.4 activate?</h1>
<h2>Stay tuned, this page will be updated when a new block height is finalized. 2.4 is currently planned to activate before stacking cycle 60 begins.</h2>
</div>
